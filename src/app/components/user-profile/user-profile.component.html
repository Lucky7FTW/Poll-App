<!-- user-profile.component.html (FULL VERSION with Delete-poll support) -->
<div class="profile-container">
  <div class="profile-card">
    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="page-header">
      <h1 class="page-title">My Profile</h1>
      <button routerLink="/" class="home-button">
        <span class="home-icon">üè†</span>
        Back to Home
      </button>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="profile-tabs">
      <button [class.active]="isActive('profile')"
              (click)="setActiveTab('profile')"
              class="tab-button">
        <span class="tab-icon">üë§</span> Profile
      </button>

      <button [class.active]="isActive('polls')"
              (click)="setActiveTab('polls')"
              class="tab-button">
        <span class="tab-icon">üìä</span> My Polls
      </button>

      <button [class.active]="isActive('security')"
              (click)="setActiveTab('security')"
              class="tab-button">
        <span class="tab-icon">üîí</span> Security
      </button>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Global spinner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner"></div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Profile TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div *ngIf="isActive('profile') && !loading" class="tab-content">
      <div class="profile-info">
        <!-- avatar -->
        <div class="avatar-section">
          <div class="avatar">
            {{ profileForm.get('displayName')?.value?.charAt(0) || 'U' }}
          </div>
          <div class="avatar-actions">
            <button class="avatar-button">Change Photo</button>
          </div>
        </div>

        <!-- profile form -->
        <div class="profile-form-container">
          <form [formGroup]="profileForm"
                (ngSubmit)="updateProfile()"
                class="profile-form">

            <!-- Display Name -->
            <div class="form-group">
              <label for="displayName" class="form-label">Display Name</label>
              <input id="displayName"
                     type="text"
                     formControlName="displayName"
                     class="form-input"
                     [class.input-error]="profileForm.get('displayName')?.invalid &&
                                          profileForm.get('displayName')?.touched" />
              <div *ngIf="profileForm.get('displayName')?.invalid &&
                           profileForm.get('displayName')?.touched"
                   class="form-error">
                Display name is required (minimum 3 characters)
              </div>
            </div>

            <!-- Email (read-only) -->
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input id="email"
                     type="email"
                     formControlName="email"
                     class="form-input disabled" />
              <div class="form-note">Email cannot be changed</div>
            </div>

            <!-- Bio -->
            <div class="form-group">
              <label for="bio" class="form-label">Bio</label>
              <textarea id="bio"
                        rows="4"
                        formControlName="bio"
                        class="form-textarea"
                        placeholder="Tell us a bit about yourself..."></textarea>
              <div class="form-note">
                {{ profileForm.get('bio')?.value?.length || 0 }}/200 characters
              </div>
            </div>

            <!-- banners -->
            <div *ngIf="updateSuccess" class="success-message">
              Profile updated successfully!
            </div>
            <div *ngIf="updateError" class="error-message">
              {{ updateError }}
            </div>

            <button type="submit"
                    class="submit-button"
                    [disabled]="profileForm.invalid || loading">
              Update Profile
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ POLLS TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div *ngIf="isActive('polls') && !loading" class="tab-content">
      <!-- control bar -->
      <div class="poll-controls">
        <select [(ngModel)]="selectedFilter" class="control-select">
          <option value="all">All</option>
          <option value="active">Active</option>
          <option value="inactive">Upcoming</option>
          <option value="closed">Ended</option>
        </select>

        <input type="text"
               [(ngModel)]="searchTerm"
               class="control-search"
               placeholder="Search your polls‚Ä¶" />

        <select [(ngModel)]="selectedSort" class="control-select">
          <option value="date-desc">Newest</option>
          <option value="date-asc">Oldest</option>
          <option value="name-asc">A-Z</option>
          <option value="name-desc">Z-A</option>
          <option value="votes-desc">Most votes</option>
          <option value="votes-asc">Least votes</option>
        </select>
      </div>

      <!-- delete error -->
      <div *ngIf="deleteError" class="error-message">
        {{ deleteError }}
      </div>

      <!-- empty state -->
      <div *ngIf="filteredPolls.length === 0" class="empty-state">
        <p>You haven‚Äôt created any polls that match these filters.</p>
        <a routerLink="/create" class="primary-button">Create Your First Poll</a>
      </div>

      <!-- poll list -->
      <div *ngIf="filteredPolls.length > 0" class="polls-list">
        <div *ngFor="let poll of filteredPolls" class="poll-item">
          <div class="poll-item-content">
            <div class="poll-item-info">
              <h3 class="poll-item-title">
                <a [routerLink]="['/poll', poll.id]">{{ poll.title }}</a>
              </h3>

              <!-- schedule -->
              <div *ngIf="poll.startDate || poll.endDate" class="poll-schedule">
                <div *ngIf="poll.startDate" class="schedule-item">
                  <span class="schedule-icon">üöÄ</span>
                  <span class="schedule-label">Starts:</span>
                  <span class="schedule-date">{{ poll.startDate | date:'medium' }}</span>
                </div>
                <div *ngIf="poll.endDate" class="schedule-item">
                  <span class="schedule-icon">üèÅ</span>
                  <span class="schedule-label">Ends:</span>
                  <span class="schedule-date">{{ poll.endDate | date:'medium' }}</span>
                </div>
              </div>

              <!-- status badge -->
              <div class="poll-status">
                <span [ngClass]="getPollStatusClass(poll)" class="status-badge">
                  {{ getPollStatus(poll) }}
                </span>
              </div>

              <!-- meta -->
              <p class="poll-item-meta">
                Created on {{ poll.createdAt | date:'medium' }} ‚Ä¢
                {{ poll.totalVotes || 0 }} votes
              </p>
            </div>
          </div>

          <!-- actions -->
          <div class="poll-item-actions">
            <a [routerLink]="['/poll', poll.id]"
               class="action-link"
               [class.disabled]="!isPollActive(poll)">
              Vote
            </a>

            <a [routerLink]="['/poll', poll.id, 'results']"
               class="action-link">
              Results
            </a>

            <a routerLink="/create"
               [queryParams]="{ edit: poll.id }"
               class="action-link">
              Edit
            </a>

            <!-- DELETE (only if Upcoming or Ended) -->
            <button *ngIf="canDeletePoll(poll)"
                    class="action-link delete-btn"
                    (click)="deletePoll(poll)"
                    [disabled]="deletingId === poll.id">
              {{ deletingId === poll.id ? 'Deleting‚Ä¶' : 'Delete' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SECURITY TAB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div *ngIf="isActive('security') && !loading" class="tab-content">
      <div class="security-section">
        <h2 class="section-title">Change Password</h2>
        <form [formGroup]="passwordForm"
              (ngSubmit)="updatePassword()"
              class="password-form">
          <!-- current password -->
          <div class="form-group">
            <label for="currentPassword" class="form-label">Current Password</label>
            <input id="currentPassword"
                   type="password"
                   formControlName="currentPassword"
                   class="form-input"
                   [class.input-error]="passwordForm.get('currentPassword')?.invalid &&
                                        passwordForm.get('currentPassword')?.touched" />
            <div *ngIf="passwordForm.get('currentPassword')?.invalid &&
                         passwordForm.get('currentPassword')?.touched"
                 class="form-error">
              Current password is required
            </div>
          </div>

          <!-- new password -->
          <div class="form-group">
            <label for="newPassword" class="form-label">New Password</label>
            <input id="newPassword"
                   type="password"
                   formControlName="newPassword"
                   class="form-input"
                   [class.input-error]="passwordForm.get('newPassword')?.invalid &&
                                        passwordForm.get('newPassword')?.touched" />
            <div *ngIf="passwordForm.get('newPassword')?.invalid &&
                         passwordForm.get('newPassword')?.touched"
                 class="form-error">
              New password must be at least 6 characters
            </div>
          </div>

          <!-- confirm -->
          <div class="form-group">
            <label for="confirmPassword" class="form-label">Confirm New Password</label>
            <input id="confirmPassword"
                   type="password"
                   formControlName="confirmPassword"
                   class="form-input"
                   [class.input-error]="(passwordForm.get('confirmPassword')?.invalid ||
                                         passwordForm.hasError('mismatch')) &&
                                        passwordForm.get('confirmPassword')?.touched" />
            <div *ngIf="passwordForm.hasError('mismatch') &&
                         passwordForm.get('confirmPassword')?.touched"
                 class="form-error">
              Passwords do not match
            </div>
          </div>

          <!-- banners -->
          <div *ngIf="passwordUpdateSuccess" class="success-message">
            Password updated successfully!
          </div>
          <div *ngIf="passwordUpdateError" class="error-message">
            {{ passwordUpdateError }}
          </div>

          <button type="submit"
                  class="submit-button"
                  [disabled]="passwordForm.invalid || loading">
            Update Password
          </button>
        </form>
      </div>

      <div class="danger-zone">
        <h2 class="danger-title">Danger Zone</h2>
        <div class="danger-content">
          <p>Once you delete your account, there is no going back. Please be certain.</p>
          <button (click)="deleteAccount()" class="delete-button">
            Delete My Account
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
