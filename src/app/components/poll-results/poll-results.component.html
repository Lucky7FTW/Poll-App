<div class="poll-results-container">
  <div class="results-card">

    <!-- loading -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
    </div>

    <!-- error -->
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <!-- main -->
    <div *ngIf="!isLoading && poll">

      <!-- header -->
      <div class="poll-header">
        <h2 class="poll-title">{{ poll.title }} - Results</h2>
        <p *ngIf="poll.description" class="poll-description">{{ poll.description }}</p>
        <div class="poll-meta">
          <div>Created by {{ poll.createdBy }} Â· {{ poll.createdAt | date:'medium' }}</div>
          <div class="total-votes">Total votes: {{ totalVotes }}</div>
        </div>
      </div>

      <!-- detailed results FIRST -->
      <div class="detailed-results">
        <h3 class="section-title">Detailed Results</h3>
        <div class="results-list">
          <div *ngFor="let r of results" class="result-item">
            <div class="result-header">
              <span class="option-text">{{ r.optionText }}</span>
              <span class="vote-info">{{ r.votes }} votes ({{ r.percentage }}%)</span>
            </div>
            <div class="progress-bar-bg">
              <div class="progress-bar" [style.width.%]="r.percentage"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- graph selector -->
      <div class="graph-switcher">
        <button [class.active]="graph==='pie'" (click)="graph='pie'">Pie</button>
        <button [class.active]="graph==='bar'" (click)="graph='bar'">Bar</button>
      </div>

      <!-- graph AFTER the list -->
      <div class="chart-container" *ngIf="graph==='pie'">
        <canvas baseChart
                [type]="'pie'"
                [data]="pieData"
                [options]="pieOpts"
                height="300">
        </canvas>
      </div>

      <div class="chart-container" *ngIf="graph==='bar'">
        <canvas baseChart
                [type]="'bar'"
                [data]="barData"
                [options]="barOpts"
                height="300">
        </canvas>
      </div>

      <!-- nav -->
      <div class="poll-footer">
        <a [routerLink]="['/polls']" class="back-link">Back to Polls</a>
        <a [routerLink]="['/poll', poll.id]" class="back-link">Back to Poll</a>
      </div>
    </div>

    <!-- not-found -->
    <div *ngIf="!isLoading && !poll && !errorMessage" class="not-found">
      <p>Poll not found</p>
    </div>

  </div>
</div>
  